workflows:
  ios-build:
    name: iOS Build

    environment:
      flutter: 3.35.7 
      groups:
        - supabase_keys
        - Firebase_keys
    
    scripts:
      # 1. السكريبت الحاسم لإنشاء ملف Firebase (Pre-build)
      - name: Create Firebase Config file
        script: | 
          echo $IOS_FIREBASE_PLIST | base64 --decode > $CM_BUILD_DIR/ios/Runner/GoogleService-Info.plist
    
      - name: Install dependencies
        script: flutter pub get
        
      - name: Build iOS
        script: |
          # تأكد أن هذا الأمر لا يزال موجوداً
          flutter build ios --release --no-codesign 
          
    # القسم الجديد الذي يجب إضافته
    artifacts:
      - build/ios/iphoneos/Runner.ipa
      - $CM_EXPORT_DIR/**/*.ipa
